---
description: Defines Notion page locations for Memory Bank. Uses PROJECT- and TASK- identifiers.
globs: memory-bank-paths.mdc
alwaysApply: true
---

# NOTION MEMORY BANK - PAGE LOCATIONS

**CRITICAL:** This project uses **Notion** as the Memory Bank backend. All read/write operations MUST use Notion MCP tools (`notion-fetch`, `notion-update-page`, `notion-create-pages`), NOT local file operations.

**Language:** All content written to Notion (page body, properties, subtasks, etc.) MUST be in **English**. Chat responses to the user may use the user's language.

## Identifier Convention

- **PROJECT-** prefix: Look up in **Projects** database
- **TASK-** prefix: Look up in **Tasks** database

Example: `PROJECT-123` → search Projects database; `TASK-588` → search Tasks database.

## Configuration

Read `.cursor/notion-memory-bank.json`:

| Key | Required | Description |
|-----|----------|-------------|
| projectId | Yes | e.g. `PROJECT-123` – current Project |
| taskId | No* | e.g. `TASK-588` – current Task; null → `/van [description]` creates one |
| projectsDataSourceUrl | Yes | Projects data source (collection://...) – from fetch of Projects database |
| tasksDataSourceUrl | Yes | Tasks data source (collection://...) – from fetch of Tasks database |
| activeContextPageId | No | activeContext subpage ID; if null, create under Project |
| progressPageId | No | progress subpage ID; if null, create under Project |
| creativePageId | No | Creative subpage ID; if null, create under Task |
| reflectionPageId | No | Reflection subpage ID; if null, create under Task |
| archivePageId | No | Archive subpage ID; if null, create under Task |

## Subpage Naming Convention

- **Project subpages** (activeContext, progress): Include `projectId` in title. Format: `Active Context PROJECT-37`, `Progress PROJECT-37`. Enables stale detection when page is not under the expected Project.
- **Task subpages** (creative, reflection, archive): Include `taskId` in title. Format: `Creative TASK-1391`, `Reflection TASK-1391`, `Archive TASK-1391`. Enables stale detection when page is not under the expected Task.

## Resolving Page IDs

1. **PROJECT-X**: Use `notion-search` with `data_source_url` = `projectsDataSourceUrl`, `query` = `PROJECT-X` or `X`. Get page URL from first result; use `notion-fetch` with that URL.
2. **TASK-Y**: Use `notion-search` with `data_source_url` = `tasksDataSourceUrl`, `query` = `TASK-Y` or `Y`. Get page URL from first result; use `notion-fetch` with that URL.
3. **Subpages**: Use explicit page IDs if set; otherwise create under Project or Task with `notion-create-pages`.

## Mapping: cursor-memory-bank → Notion

| Memory Bank Concept | Notion Location | Config Key |
|---------------------|-----------------|------------|
| tasks.md | Current Task page body | taskId (TASK-588) |
| projectbrief.md | Project page body | projectId (PROJECT-123) |
| activeContext.md | activeContext subpage under Project | activeContextPageId |
| progress.md | progress subpage under Project | progressPageId |
| creative/creative-[name].md | Creative subpage under Task | creativePageId |
| reflection/reflection-[id].md | Reflection subpage under Task | reflectionPageId |
| archive/archive-[id].md | Archive subpage under Task | archivePageId |

## Page Links in Content

- **Cross-references** (References, progress, activeContext): use `<mention-page url="[URL]">[Title]</mention-page>`
- **Preserving child pages** (replace_content_range): use `<page url="...">` to keep child structure. Do NOT use `<page>` for cross-references – that can move pages.
- **Reflection/Archive under Task:** Use ONLY `<page url="...">`. Do NOT combine with `<mention-page>` – that creates redundant display.

## MCP Tool Usage

- **Read**: Resolve identifier → `notion-fetch` with page ID or URL.
- **Update content**: `notion-update-page` with `command: "replace_content"` or `replace_content_range` or `insert_content_after`.
- **Create page**: `notion-create-pages` with `parent: { page_id: "..." }` and `properties: { title: "..." }`, `content: "..."`.

## Token Optimization

- **Read**: Only when user mentions project name, says "continue", "load context", or at command start. Fetch once per session when possible.
- **Write**: Only when user explicitly triggers (e.g. "update memory bank", "save progress") or at end of /van, /plan, /creative, /build, /reflect, /archive.
